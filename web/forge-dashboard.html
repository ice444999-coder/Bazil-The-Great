<!-- HUMAN MODE - Truth Protocol Active
     System: Senior CTO-scientist reasoning mode engaged
     Reward = TRUTH_PROVEN via tests. Claims = PROVISIONAL until verified.
     This file protected by HUMAN-TRUTH protocol - see truth_protocol/README.md -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARES - FORGE Apprenticeship</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0B0E11;
            color: #EAECEF;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ARES Sidebar (Purple) */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .logo p {
            font-size: 12px;
            opacity: 0.8;
        }

        .user-info {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .nav-menu {
            flex: 1;
            overflow-y: auto;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        
        /* ENHANCED NAVIGATION ACTIVE STATE - High Specificity */
        .sidebar .nav-menu a.nav-item.active,
        nav.nav-menu a.nav-item.active,
        div.nav-menu a.nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-left: 4px solid #fff !important;
            color: #fff !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
        }

        /* Hover effect for nav items */
        .sidebar .nav-menu a.nav-item:hover:not(.active) {
            background: rgba(255,255,255,0.15) !important;
            transform: translateX(2px);
            transition: all 0.2s ease;
        }

        .logout-btn {
            padding: 12px 20px;
            margin: 20px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Main Content */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #1E2329;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #2B3139;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #848E9C;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-card .subtext {
            font-size: 12px;
            color: #848E9C;
        }

        .patterns-table {
            background: #1E2329;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #2B3139;
        }

        .patterns-table h2 {
            margin-bottom: 20px;
            color: #EAECEF;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #2B3139;
            color: #848E9C;
            font-weight: 600;
            font-size: 12px;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #2B3139;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #2B3139;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge.ready {
            background: #0ECB81;
            color: white;
        }

        .badge.learning {
            background: #F6465D;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #848E9C;
        }

        /* Code Generation Cards */
        .code-card {
            background: #1E2329;
            border: 1px solid #2B3139;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }

        .code-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }

        .code-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .code-card-title {
            font-size: 14px;
            font-weight: 600;
            color: #EAECEF;
        }

        .code-card-actions {
            display: flex;
            gap: 8px;
        }

        .btn-approve {
            background: #0ECB81;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .btn-reject {
            background: #F6465D;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .code-preview {
            background: #0B0E11;
            border: 1px solid #2B3139;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #0ECB81;
            overflow-x: auto;
            max-height: 150px;
            overflow-y: auto;
        }

        .code-meta {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            font-size: 11px;
            color: #848E9C;
        }

        /* Pattern Library Cards */
        .pattern-card {
            background: #1E2329;
            border: 1px solid #2B3139;
            border-radius: 8px;
            padding: 15px;
        }

        .pattern-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .pattern-icon {
            font-size: 24px;
        }

        .pattern-confidence {
            font-size: 18px;
            font-weight: 700;
            color: #0ECB81;
        }

        .pattern-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .pattern-description {
            font-size: 12px;
            color: #848E9C;
            margin-bottom: 10px;
        }

        .pattern-stats {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #848E9C;
            border-top: 1px solid #2B3139;
            padding-top: 10px;
        }
            .back-btn {
            position: absolute;
            top: 20px;
            left: 30px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.3s;
            text-decoration: none;
            z-index: 1000;
        }

        .back-btn:hover {
            background: #764ba2;
            transform: translateX(-3px);
        }

        .back-btn::before {
            content: '‚Üê';
            font-size: 18px;
        }
</style>
</head>
<body>
    <div class="container">
        <!-- ARES Purple Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>ARES</h1>
                <p>Autonomous Research & Execution System</p>
            </div>

            <div class="user-info">
                <div style="font-weight: 600;">SOLACE</div>
                <div style="font-size: 12px; opacity: 0.7;">AI Trading System</div>
            </div>

            <div class="nav-menu">
                <a href="/dashboard.html" class="nav-item">
                    <span>üè†</span>
                    <span>Dashboard</span>
                </a>
                <a href="/trading.html" class="nav-item">
                    <span>ÔøΩ</span>
                    <span>Trading</span>
                </a>
                <a href="/solace-trading.html" class="nav-item">
                    <span>üß†</span>
                    <span>SOLACE Consciousness</span>
                </a>
                <a href="/forge-dashboard.html" class="nav-item active">
                    <span>üéì</span>
                    <span>FORGE Apprenticeship</span>
                </a>
                <a href="/code-ide.html" class="nav-item">
                    <span>ü§ñ</span>
                    <span>Code IDE</span>
                </a>
                <a href="/chat.html" class="nav-item">
                    <span>üí¨</span>
                    <span>Chat</span>
                </a>
                <a href="/solace-control.html" class="nav-item">
                    <span>üéõÔ∏è</span>
                    <span>SOLACE Control</span>
                </a>
                <a href="/editor.html" class="nav-item">
                    <span>üìù</span>
                    <span>Editor</span>
                </a>
                <a href="/memory.html" class="nav-item">
                    <span>üß†</span>
                    <span>Memory</span>
                </a>
                <a href="/vision.html" class="nav-item">
                    <span>üëÅÔ∏è</span>
                    <span>Vision</span>
                </a>
                <a href="/health.html" class="nav-item">
                    <span>‚ù§Ô∏è</span>
                    <span>Health</span>
                </a>
            </div>

            <button class="logout-btn">Logout</button>
        </div>

        <!-- Main Content -->
        <div class="content">
            <div class="header">
                <a href="/dashboard.html" class="back-btn">Back</a>
                <h1>üéì FORGE Apprenticeship Dashboard</h1>
                <p style="color: #848E9C;">GitHub Copilot ‚Üí FORGE Learning System</p>
            </div>

            <div class="stats-grid" id="statsGrid">
                <div class="loading">Loading FORGE statistics...</div>
            </div>

            <div class="patterns-table">
                <h2>Pattern Graduation Progress</h2>
                <div id="patternsTable">
                    <div class="loading">Loading patterns...</div>
                </div>
            </div>

            <!-- Code Generation Review Section -->
            <div style="margin-top: 30px;">
                <h2>ü§ñ Recent Code Generations</h2>
                <div id="codeGenerations" style="display: grid; gap: 15px; margin-top: 15px;">
                    <div class="loading">Loading recent code generations...</div>
                </div>
            </div>

            <!-- Pattern Library -->
            <div style="margin-top: 30px;">
                <h2>üìö Pattern Library</h2>
                <div id="patternLibrary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div class="loading">Loading pattern library...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load FORGE statistics
        async function loadStats() {
            try {
                const response = await fetch('http://localhost:8080/api/v1/forge/confidence');
                const data = await response.json();
                
                const statsGrid = document.getElementById('statsGrid');
                
                // Calculate summary stats
                const totalPatterns = data.patterns?.length || 0;
                const readyPatterns = data.patterns?.filter(p => p.graduation_ready).length || 0;
                const avgConfidence = data.patterns?.reduce((sum, p) => sum + (p.avg_confidence || 0), 0) / totalPatterns || 0;
                const totalExamples = data.patterns?.reduce((sum, p) => sum + (p.examples_count || 0), 0) || 0;

                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <h3>Total Patterns</h3>
                        <div class="value">${totalPatterns}</div>
                        <div class="subtext">Being trained</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ready to Graduate</h3>
                        <div class="value" style="color: #0ECB81;">${readyPatterns}</div>
                        <div class="subtext">‚â•95% confidence</div>
                    </div>
                    <div class="stat-card">
                        <h3>Average Confidence</h3>
                        <div class="value">${(avgConfidence * 100).toFixed(1)}%</div>
                        <div class="subtext">Across all patterns</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Examples</h3>
                        <div class="value">${totalExamples}</div>
                        <div class="subtext">GitHub Copilot observations</div>
                    </div>
                `;

                loadPatterns(data.patterns);
            } catch (error) {
                console.error('Failed to load FORGE stats:', error);
                document.getElementById('statsGrid').innerHTML = 
                    '<div class="loading" style="color: #F6465D;">Failed to connect to ARES API. Is the server running on port 8080?</div>';
            }
        }

        function loadPatterns(patterns) {
            const table = document.getElementById('patternsTable');
            
            if (!patterns || patterns.length === 0) {
                table.innerHTML = '<div class="loading">No patterns found</div>';
                return;
            }

            table.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Pattern Type</th>
                            <th>Examples</th>
                            <th>Confidence</th>
                            <th>Success Rate</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${patterns.map(p => `
                            <tr>
                                <td style="font-weight: 600;">${p.pattern_type}</td>
                                <td>${p.examples_count || 0}</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${(p.avg_confidence || 0) * 100}%"></div>
                                    </div>
                                    <div style="font-size: 12px; margin-top: 4px;">${((p.avg_confidence || 0) * 100).toFixed(1)}%</div>
                                </td>
                                <td>${((p.success_rate || 0) * 100).toFixed(0)}%</td>
                                <td>
                                    <span class="badge ${p.graduation_ready ? 'ready' : 'learning'}">
                                        ${p.graduation_ready ? '‚úì Ready' : 'üéì Learning'}
                                    </span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Load code generations (mock data for now)
        function loadCodeGenerations() {
            const container = document.getElementById('codeGenerations');
            
            const mockGenerations = [
                {
                    id: 1,
                    pattern: 'API Endpoint Handler',
                    code: 'func HandleGetTrades(c *gin.Context) {\n    trades, err := db.GetRecentTrades()\n    if err != nil {\n        c.JSON(500, gin.H{"error": err.Error()})\n        return\n    }\n    c.JSON(200, trades)\n}',
                    confidence: 87,
                    timestamp: '2 min ago',
                    status: 'pending'
                },
                {
                    id: 2,
                    pattern: 'Database Query',
                    code: 'SELECT symbol, price, volume FROM trades WHERE timestamp > $1 ORDER BY timestamp DESC LIMIT 100',
                    confidence: 92,
                    timestamp: '15 min ago',
                    status: 'pending'
                }
            ];
            
            container.innerHTML = mockGenerations.map(gen => `
                <div class="code-card">
                    <div class="code-card-header">
                        <div class="code-card-title">${gen.pattern}</div>
                        <div class="code-card-actions">
                            <button class="btn-approve" onclick="approveCode(${gen.id})">‚úì Approve</button>
                            <button class="btn-reject" onclick="rejectCode(${gen.id})">‚úó Reject</button>
                        </div>
                    </div>
                    <div class="code-preview">${gen.code}</div>
                    <div class="code-meta">
                        <span>Confidence: <strong>${gen.confidence}%</strong></span>
                        <span>Generated: ${gen.timestamp}</span>
                        <span>Status: <strong>${gen.status}</strong></span>
                    </div>
                </div>
            `).join('');
        }

        // Load pattern library
        function loadPatternLibrary() {
            const container = document.getElementById('patternLibrary');
            
            const mockPatterns = [
                {
                    icon: 'üîß',
                    name: 'REST API Endpoints',
                    description: 'Creating HTTP handlers with proper error handling and JSON responses',
                    confidence: 94,
                    examples: 156,
                    successRate: 89
                },
                {
                    icon: 'üíæ',
                    name: 'Database Operations',
                    description: 'SQL queries, transactions, and connection pooling patterns',
                    confidence: 91,
                    examples: 203,
                    successRate: 92
                },
                {
                    icon: 'üîê',
                    name: 'Authentication',
                    description: 'JWT token validation, middleware, and user session management',
                    confidence: 88,
                    examples: 89,
                    successRate: 85
                },
                {
                    icon: 'üìä',
                    name: 'Data Validation',
                    description: 'Input sanitization, type checking, and business rule enforcement',
                    confidence: 96,
                    examples: 178,
                    successRate: 94
                },
                {
                    icon: 'üß™',
                    name: 'Unit Tests',
                    description: 'Test cases, mocking, and assertion patterns',
                    confidence: 82,
                    examples: 134,
                    successRate: 78
                },
                {
                    icon: '‚ö°',
                    name: 'Error Handling',
                    description: 'Try-catch blocks, error propagation, and logging',
                    confidence: 93,
                    examples: 221,
                    successRate: 91
                }
            ];
            
            container.innerHTML = mockPatterns.map(pattern => `
                <div class="pattern-card">
                    <div class="pattern-card-header">
                        <div class="pattern-icon">${pattern.icon}</div>
                        <div class="pattern-confidence">${pattern.confidence}%</div>
                    </div>
                    <div class="pattern-name">${pattern.name}</div>
                    <div class="pattern-description">${pattern.description}</div>
                    <div class="pattern-stats">
                        <span>${pattern.examples} examples</span>
                        <span>${pattern.successRate}% success</span>
                        <span>${pattern.confidence >= 95 ? '‚úì Ready' : 'üéì Learning'}</span>
                    </div>
                </div>
            `).join('');
        }

        function approveCode(id) {
            alert(`Code generation ${id} approved! FORGE will learn from this positive feedback.`);
            // TODO: Call API to approve code
            // fetch(`/api/v1/forge/approve/${id}`, { method: 'POST' })
        }

        function rejectCode(id) {
            const reason = prompt('Why are you rejecting this code? (This helps FORGE learn)');
            if (reason) {
                alert(`Code generation ${id} rejected. FORGE will learn from: "${reason}"`);
                // TODO: Call API to reject code with reason
                // fetch(`/api/v1/forge/reject/${id}`, { method: 'POST', body: JSON.stringify({ reason }) })
            }
        }

        // Load on page load
        loadStats();
        loadCodeGenerations();
        loadPatternLibrary();

        // Refresh every 30 seconds
        setInterval(() => {
            loadStats();
            loadCodeGenerations();
        }, 30000);
    </script>
</body>
</html>
